<!DOCTYPE html>
<html lang="ko"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/defaultLayout}">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: Arial, Helvetica, sans-serif;  
  margin: 0px;
}
.insert_box {
  width: 100%;
  padding: 12px;
  border: 1px solid #ccc;
  border-radius: 4px;
  box-sizing: border-box;
  margin-top: 6px;
  margin-bottom: 16px;
  resize: vertical;
}
.textarea{
  height: 200px;
}
.blue_button {
  background-color: #0063DD;
  color: white;
  padding: 12px 20px;
  border: none;
  border-radius: 15px;
  cursor: pointer;
}
.hover_button:hover {
  opacity: 0.8;
}
.container {
  border-radius: 5px;
  padding: 20px;
  width: 80%;
  margin: auto;
  height: 800px;
}
#w_div{
  width: 100%;
  height: 50px;
  border-top:3px solid #093687 ;
  border-bottom: 1px solid #093687;
  font-size: 30px;
}
</style>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdn.ckeditor.com/4.16.0/standard/ckeditor.js"></script>

<script>

/*$(function(){ //onLoad되면
  //편집기 입히기
  CKEDITOR.replace( 'content' );
});*/

</script>
</head>

<body>
<th:block layout:fragment="content">
<div class="container">
  <div id="w_div">글쓰기</div><br>
  
  <form id="registForm" method="post">
  	<div>
        <div>제목</div>
        <input type="text" id="title" class="insert_box" placeholder="제목을 입력해주세요">
    </div>
    <div>
        <div>작성자</div>
        <input type="text" id="writer" class="insert_box" placeholder="작성자를 입력해주세요">
    </div>
    <div>
    	<div>공개여부</div>
    	<div class="insert_box">
	        <input type="radio" id="expY" name="expYn" value="Y">
	        <label for="expY">공개 </label>
	        <input type="radio" id="expN" name="expYn" value="N">
	        <label for="expN">비공개 </label>
        </div>
    </div>
    <div>
		<div>게시글 유형</div>
		<div class="insert_box" id="notiTyp">	
	        <input type="checkbox" value="FREE" id="notiTyp1" name="notiTyp">
	        <label for="notiTyp1">자유</label>
	        <input type="checkbox" value="ANON" id="notiTyp2" name="notiTyp">
	        <label for="notiTyp2">익명</label>
	        <input type="checkbox" value="SCRT" id="notiTyp3" name="notiTyp">
	        <label for="notiTyp3">비밀</label>
		</div>
    </div>
    <div>
		<div>댓글 허용여부</div>
		<select id="cmntYn">
			<option value="">==선택==</option>
			<option value="Y">허용</option>
			<option value="N">허용안함</option>
		</select>
    </div>
    <br>
    <div>
        <div>내용</div>
        <textarea id="content" class="insert_box textarea"></textarea>
    </div>
    
    <br>
    <input type="button" onclick="registNotice()" class="blue_button hover_button" th:value="등록">
    <input type="button" th:onclick="|location.href='@{/listNotices(page=${page})}'|" class="blue_button hover_button" th:value="목록" >
    <!--<input type="button" onclick="moveList()" class="blue_button hover_button" th:value="목록" >-->
  </form>

</div>

</th:block>
</body>
<script type="text/javascript">

// 글 목록으로 이동
function moveList(){
	
	// 전송 데이터
	var formData = {
		notiNo : "1",
	}
	
	$.ajax({
		type: "GET",
		url: "/detail",
		data: notiId,
		success: function(data){
			console.log(data);
		}
	});
	
}


// 글 등록
function registNotice(){
	
	if(confirm('글을 등록하시겠습니까?')){
		
		// 게시물 유형 배열
		var chkTyp = [];
		$('input[name=notiTyp]:checked').each(function(){
			chkTyp.push($(this).val());
		});
		// 게시물 유형 ,로 나눈 문자열로 변환
		var notiTyp = chkTyp.join(',');
		
		// 전송 데이터
		var formData = {
			title : $.trim($("#title").val()),
			writer : $.trim($("#writer").val()),
			expYn : $('input[name=expYn]:checked').val(),
			notiTyp : notiTyp, 
			cmntYn : $("#cmntYn").val(),
			cont : $.trim($("#content").val()),
		}
		
		// Validation Check	
		if(formData.title == ""){
			alert('제목을 입력해주세요.')
			return;
		}else if(formData.writer == ""){
			alert('작성자를 입력해주세요.')
			return;
		}else if(formData.expYn == null){
			alert('공개여부를 선택해주세요.')
			return;
		}else if(chkTyp.length == 0){
			alert('게시물 유형을 선택해주세요.')
			return;
		}else if(formData.cmntYn == ""){
			alert('댓글 허용여부를 선택해주세요.')
			return;
		}else if(formData.cont == ""){
			alert('내용을 입력해주세요.')
			return;
		}
		
		console.log(formData);
		
		$.ajax({
			type: "POST",
			url: "/registNotice",
			contentType: "application/json; charset=UTF-8",
			data: JSON.stringify(formData),
			success: function(data){
				alert('글이 등록되었습니다.');
				location.href="/listNotices";
			}
		});
	
	}else{
		alert('글 등록을 취소하셨습니다.')
	}

}

</script>
</html>